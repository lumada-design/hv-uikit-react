import { Meta, Story, Preview } from "@storybook/addon-docs";

import LinkTo from "@storybook/addon-links/react";

import { Usage } from "storybook-root/blocks/Usage";

import { HvTable } from "../..";

import * as stories from "./TableHooks.stories.js";

<Meta title="Lab/Table Hooks" />

# Table hooks

[React Table](https://react-table.tanstack.com) is an "headless" UI utility library that allows to build data tables while retaining control over markup and styles.

It consists of a collection of custom React hooks. These hooks are lightweight, composable and extensible.
The UI Kit library provides some custom hooks that ease the integration with the <LinkTo kind="Lab/Table" story="Main" className="sbdocs-a">Table component</LinkTo>.

Together is easier to build powerful experiences and extend the features offered.

<Usage>{'import { useTable } from "react-table";'}</Usage>

<Preview withToolbar>
  <Story inline story={stories.Main} />
</Preview>

## The `useHv*` hooks

For further ease, you can use the provided `useHvTable` hook that wraps the [React Table's `useTable` hook](https://react-table.tanstack.com/docs/api/useTable) and
provides the following functionality:

- Ensures the use of the needed core and layout plugins when using any of the UI Kit custom hooks (e.g. adding `useHvPagination` implies the instalation of React Table's `usePagination` hook).
- Automatically installs the `useHvTableStyles` hook.
- Generates default column metadata from the data fields, if the `columns` option is missing.
- Defaults to an empty array if no `data` is provided.

The following plugin hooks are available:

- `useHvTableStyles`: ensures the correct styling of the table by injecting the column's `variant` and `align` options into the `HvTableHeader` and `HvTableCell` components (via `getHeaderProps` and `getCellProps`, respectively).
  Also adds support for injecting the `styles`, `className` and `classes` into the `HvTable`, `HvTableHeader` and `HvTableCell` components.
- `useHvPagination`: eases the wiring of the `HvPagination` component when using pagination. See <a href="#pagination" className="sbdocs-a">Pagination</a>.
- `useHvRowSelection`: creates and manages the UI for selecting rows. See <a href="#selection" className="sbdocs-a">Selection</a>.
- `useHvBulkActions`: eases the wiring of the `HvBulkActions` component. See <a href="#bulk-selection-and-actions" className="sbdocs-a">Bulk selection and actions</a>.
- `useHvSortBy`: manages the table's header sorting functionality. See <a href="#sorting" className="sbdocs-a">Sorting</a>.
- `useHvRowExpand`: manages the row expanding functionality. See <a href="#row-expanding" className="sbdocs-a">Row expanding</a>.
- `useHvTableSticky`: allows defining sticky headers and columns. See <a href="#sticky-headers-and-columns" className="sbdocs-a">Sticky Headers And Columns</a>.

## Pagination

Data can be paginated. Optionally, empty lines can be added to the last page to avoid changes in height.

Check [React Table's `usePagination` documentation](https://react-table.tanstack.com/docs/api/usePagination) for configuration details.

The `useHvPagination` hook makes the `getHvPaginationProps` function available on the table instance returned that can be used to setup a `HvPagination` component.

_Note: This hook depends on the `usePagination` hook from `react-table`, but when using `useHvTable` only `useHvPagination` needs to be installed._

<Preview withToolbar>
  <Story inline story={stories.Pagination} />
</Preview>

## Selection

Rows can be selected individually.

Check [React Table's `useRowSelect` documentation](https://react-table.tanstack.com/docs/api/useRowSelect) for configuration details.

The `useHvRowSelecion` hook injects a new column with a `HvCheckBox` to select each row. It also manages the `HvTableRow`'s `isSelected` property via the `getRowProps`.

This hook is originally based on the code `useRowSelect` hook from `react-table` and implements its API, but extends it with support for locking the selection state of individual rows.

<Preview withToolbar>
  <Story inline story={stories.Selection} />
</Preview>

## Bulk selection and actions

Rows can also be selected in bulk and actions can be performed on the current selection.

The `useHvBulkActions` hook makes the `getHvBulkActionsProps` function available on the table instance returned that can be used to setup a `HvBulkActions` component.

_Note: This hook depends on the `useRowSelect` hook from `react-table`, but when using `useHvTable` only `useHvBulkActions` needs to be installed._

<Preview withToolbar>
  <Story inline story={stories.BulkActions} />
</Preview>

## Sorting

Tables can have the capability of sorting the data by column.
Clicking a sortable column header toggles between ascending or descending. Multiple sorting criteria is enabled through holding shift while clicking.

Check [React Table's `useSortBy` documentation](https://react-table.tanstack.com/docs/api/useSortBy) for configuration details.

The `useHvSortBy` hook ensures that the proper properties are injected in the `HvTableHeader` (including the on click sorting trigger) and `HvTableCell` (for styling).

_Note: This hook depends on the `useSortBy` hook from `react-table`, but when using `useHvTable` only `useHvSortBy` needs to be installed._

<Preview withToolbar>
  <Story inline story={stories.Sortable} />
</Preview>

## Row expanding

Tables rows can have the capability of being expanded to show more details.

Check [React Table's `useExpanded` documentation](https://react-table.tanstack.com/docs/api/useExpanded) for configuration details.

The `useHvRowExpand` hook injects a `HvButton` into the first data column that toggles each row expansion. If the column has a custom renderer, an extra column is created instead.

_Note: This hook depends on the `useExpanded` hook from `react-table`, but when using `useHvTable` only `useHvRowExpand` needs to be installed._

<Preview withToolbar>
  <Story inline story={stories.Expandable} />
</Preview>

## Sticky Headers And Columns

The table headers can be fixed at the top, allowing it to keep always visible when table has vertical scrolling enabled.

It is also possible to stick columns, either on the left or on the right, making them always visible when scrolling horizontally.

This is implemented using the `useHvTableSticky` custom React Table hook provided by the UI Kit library.

When using sticky columns, all column widths will be fixed and a non-table-element layout is applied.

### Configuration

The following options are supported via the main options object passed to `useTable(options)`:

- `stickyHeader: Bool`
  - Enables the sticky header

The following options are supported on any `Column` object passed to the `columns` options in `useTable()`:

- `sticky: "left" | "right"`
  - Sticks this column to the defined side. Columns will be re-orderer if needed.
- `width: Int`
  - Defaults to 150
  - Specifies the width for the column

### Usage

The `getTableProps`, `getTableHeadProps`, `getHeaderGroupProps`, `getHeaderProps`, `getTableBodyProps`, `getRowProps` and `getCellProps` prop getters must be called and the properties injected into the corresponding elements.

<Preview withToolbar>
  <Story inline story={stories.StickyHeadersAndColumns} />
</Preview>

## Empty Cells

The absence of data within an individual cell in the table should be displayed as a `â€”` (_em dash_), according to Design System guidelines.

This must be handled by the developer in the respective cell renderer, as it is an guideline and not a strict rule.
Different use cases may require different solutions, like `N/A` or `0`. Empty cells should be avoided.

<Preview withToolbar>
  <Story inline story={stories.EmptyCells} />
</Preview>

## Locked Selection

Individual rows can have its selection state locked (becoming either not selectable or not unselectable), disabling the selection checkbox and also preventing the bulk actions to change the row state.

<Preview withToolbar>
  <Story inline story={stories.LockedSelection} />
</Preview>

# Stuff still to be documented

## Server Side

<Preview withToolbar>
  <Story inline story={stories.ServerSide} />
</Preview>
