import { Meta, Canvas, Story } from "@storybook/addon-docs";
import * as TableHooksStories from "./TableHooks.stories";

<Meta title="Guides/Table/Table Hooks" />

# Table Hooks

The UI Kit library provides a collection of custom hooks that ease the integration with the [HvTable elements](/docs/guides-table--main) and allows more advanced
use cases and better data handling. Our custom hooks are built on top of [React Table](https://tanstack.com/table/v8/?from=reactTableV7&original=https://react-table-v7.tanstack.com/)
which is an "headless" UI utility library to build data tables while retaining control over markup and styles. It consists of a collection of lightweight,
composable, and extensible custom React hooks.

## useHv\* Hooks

For further ease, you can use the provided `useHvData` hook that wraps the
[React Table's `useTable` hook](https://tanstack.com/table/v8/docs/guide/tables?from=reactTableV7&original=https://react-table-v7.tanstack.com/docs/api/useTable)
and provides the following functionality:

- Ensures the use of the needed core and layout plugins when using any of the UI Kit custom hooks (e.g. adding `useHvPagination` implies the installation of
  React Table's `usePagination` hook).
- Automatically installs the `useHvTableStyles` hook.
- Generates default column metadata from the data fields, if the `columns` option is missing.
- Defaults to an empty array if no `data` is provided.

The following plugin hooks are available:

- `useHvTableStyles`: Ensures the correct styling of the table by injecting the column's `variant` and `align` options into the `HvTableHeader` and
  `HvTableCell` components (via `getHeaderProps` and `getCellProps`, respectively). Also adds support for injecting the `styles`, `className` and
  `classes` into the `HvTable`, `HvTableHeader`, and `HvTableCell` components.
- `useHvPagination`: Eases the wiring of the `HvPagination` component when using pagination. [See pagination](#use-hv-pagination).
- `useHvRowSelection`: Creates and manages the UI for selecting rows. [See selection](#use-hv-row-selection).
- `useHvBulkActions`: Eases the wiring of the `HvBulkActions` component. [See bulk selection and actions](#use-hv-bulk-actions).
- `useHvSortBy`: Manages the table's header sorting functionality. [See sorting](#use-hv-sort-by).
- `useHvRowExpand`: Manages the row expanding functionality. [See row expanding](#use-hv-row-expand).
- `useHvGroupBy`: Allows defining header groups. [See selection](#use-hv-group-by).
- `useHvTableSticky`: Allows defining sticky headers and columns. [See sticky headers and columns](#use-hv-table-sticky).
- `useHvHeaderGroups`: Allows defining grouped headers. [See grouped headers](#use-hv-header-groups).

<Canvas>
  <Story name="useHv* Hooks" story={TableHooksStories.UseHvHooksStory} />
</Canvas>

### useHvPagination <a id="use-hv-pagination" />

Data can be paginated. Optionally, empty lines can be added to the last page to avoid changes in height.

Check [React Table's `usePagination` documentation](https://react-table.tanstack.com/docs/api/usePagination) for configuration details.

The useHvPagination hook makes the `getHvPaginationProps` function available on the table instance returned that can be used to setup a
`HvPagination` component.

<Canvas>
  <Story
    name="useHvPagination"
    story={TableHooksStories.UseHvPaginationStory}
  />
</Canvas>

### useHvRowSelection <a id="use-hv-row-selection" />

Rows can be selected individually.

Check [React Table's `useRowSelect` documentation](https://react-table.tanstack.com/docs/api/useRowSelect) for configuration details.

The `useHvRowSelection` hook injects a new column with a `HvCheckBox` to select each row. It also manages the `HvTableRow's` `isSelected` property via the
`getRowProps`.

This hook is originally based on the code `useRowSelect` hook from react-table and implements its API, but extends it with support for locking the selection
state of individual rows.

<Canvas>
  <Story name="useHvSelection" story={TableHooksStories.UseHvSelectionStory} />
</Canvas>

### useHvRowSelection Controlled <a id="use-hv-row-selection-controlled" />

A selection state can also be included in the data and toggled externally.

<Canvas>
  <Story
    name="useHvRowSelection controlled"
    story={TableHooksStories.UseHvSelectionControlledStory}
  />
</Canvas>

### useHvBulkActions <a id="use-hv-bulk-actions" />

Rows can also be selected in bulk and actions can be performed on the current selection.

The `useHvBulkActions` hook makes the `getHvBulkActionsProps` function available on the table instance returned that can be used to setup a `HvBulkActions` component.

_Note: This hook depends on the `useRowSelect` hook from `react-table`, but when using `useHvData` only `useHvBulkActions` needs to be installed._

<Canvas>
  <Story
    name="useHvBulkActions"
    story={TableHooksStories.UseHvBulkActionsStory}
  />
</Canvas>

### useHvSortBy <a id="use-hv-sort-by" />

Tables can have the capability of sorting the data by column. Clicking a sortable column header toggles between ascending or descending. Multiple sorting criteria
is enabled through holding shift while clicking.

Check [React Table's `useSortBy` documentation](https://react-table.tanstack.com/docs/api/useSortBy) for configuration details.

The `useHvSortBy` hook ensures that the proper properties are injected in the `HvTableHeader` (including the on click sorting trigger) and `HvTableCell` (for styling).

_Note: This hook depends on the `useSortBy` hook from `react-table`, but when using `useHvData` only `useHvSortBy` needs to be installed._

<Canvas>
  <Story name="useHvSortBy" story={TableHooksStories.UseHvSortByStory} />
</Canvas>

### useHvRowExpand <a id="use-hv-row-expand" />

Tables rows can have the capability of being expanded to show more details.

Check [React Table's `useExpanded` documentation](https://react-table.tanstack.com/docs/api/useExpanded) for configuration details.

The `useHvRowExpand` hook injects a `HvButton` into the first data column that toggles each row expansion. If the column has a custom renderer, an
extra column is created instead.

_Note: This hook depends on the `useExpanded` hook from `react-table`, but when using `useHvData` only `useHvRowExpand` needs to be installed._

<Canvas>
  <Story name="useHvRowExpand" story={TableHooksStories.UseHvRowExpandStory} />
</Canvas>

### useHvGroupBy <a id="use-hv-group-by" />

Tables rows can have the capability of being expanded to show more details.

Check [React Table's `useGroupBy` documentation](https://react-table.tanstack.com/docs/api/useGroupBy) for configuration details.

This example requires `useHvRowExpand` to show the grouped rows.

<Canvas>
  <Story name="useHvGroupBy" story={TableHooksStories.UseHvGroupByStory} />
</Canvas>

### useHvTableSticky <a id="use-hv-table-sticky" />

The table headers can be fixed at the top, allowing it to keep always visible when table has vertical scrolling enabled.

It is also possible to stick columns, either on the left or on the right, making them always visible when scrolling horizontally.

This is implemented using the `useHvTableSticky` custom React Table hook provided by the UI Kit library.

When using sticky columns, all column widths will be fixed and a non-table-element layout is applied.

#### Configuration

The following options are supported via the main options object passed to `useTable(options)`:

- `stickyHeader: boolean`: Enables the sticky header.

The following options are supported on any `Column` object passed to the `columns` options in `useTable()`:

- `sticky: "left" | "right"`: Sticks this column to the defined side. Columns will be re-orderer if needed.
- `width: number`: Specifies the width for the column. Defaults to 150.
- `minWidth: number`: Specifies the minimum width for the column. Defaults to 0.

#### Usage

The `getTableProps`, `getTableHeadProps`, `getHeaderGroupProps`, `getHeaderProps`, `getTableBodyProps`, `getRowProps`, and `getCellProps` prop getters must be
called and the properties injected into the corresponding elements.

<Canvas>
  <Story
    name="useHvTableSticky"
    story={TableHooksStories.UseHvTableStickyStory}
  />
</Canvas>

### useHvHeaderGroups <a id="use-hv-header-groups" />

The table columns can be grouped, allowing it to have header groups.

Check [React Table's `useTable` documentation](https://react-table.tanstack.com/docs/api/useTable#column-options) for configuration details.

This is implemented using the `useHvHeaderGroups` custom React Table hook provided by the UI Kit library.

When using grouped columns, all header group columns text will be centered.

#### Configuration

The following options are supported on any `Column` object passed to the `columns` options in `useTable()`:

- `columns: Array<Column>`: A nested array of columns. If defined, the column will act as a header group. Columns can be recursively nested as much as needed.

#### Usage

The `getTableProps`, `getHeaderGroupProps`, `getHeaderProps`, `getTableBodyProps`, `getRowProps`, and `getCellProps` prop getters must be called
and the properties injected into the corresponding elements.

<Canvas>
  <Story
    name="useHvHeaderGroups"
    story={TableHooksStories.UseHvHeaderGroupsStory}
  />
</Canvas>
