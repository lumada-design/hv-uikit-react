import { Meta, Title } from "@storybook/addon-docs";

<Meta title="Overview/Community/Component Guidelines" />

<Title>Component Guidelines</Title>

This guide aims to provide insights and recommendations for building and contributing
robust and adaptable components that are consistent with the existing UI Kit library.

## File Structure & Purpose

The directory should contain the following files:

```sh
HvComp/
â”œâ”€â”€ index.ts            # entry file with the component's public exports
â”œâ”€â”€ HvComp.tsx          # component implementation and types
â”œâ”€â”€ HvComp.stories.tsx  # component documentation and examples
â”œâ”€â”€ HvComp.styles.ts    # component classes and styling utils
â””â”€â”€ HvComp.test.tsx     # component unit tests
```

## Guidelines

- Ensure that components and their types:
  - are _exported_ in `index.ts`
  - are named in PascalCase and prefixed with `Hv*`.
- Exports the components in the `index.ts` file.
- Make boolean props opt-in (default is `false`).
- Call Event handlers `on<Action>`.

### Styles

- Use `createClasses` utility to declare classes.
- Class names in `createClasses` are exposed to users, so be mindful of naming:
  - Ensure `classes.root` is on the root element.
  - Make it clear what element the class targeting when it isn't the root element.
  - If conditional, the class name should be based on the condition.
- Leverage `theme` to style component. Don't hard-code colors or spacings.

### Documentation

- Add a `Component.stories.tsx` exporting multiple [CSF](https://storybook.js.org/docs/react/api/csf) stories.
- Name the primary story `Main` and configure the [controls](https://storybook.js.org/docs/react/essentials/controls).
- Avoid adding too many similar stories; each story should have a unique purpose.

### Others

- Use `@testing-library/react` for unit tests.
- Prefer semantic HTML elements instead of custom logic whenever possible.
- Follow [WCAG](https://www.w3.org/TR/WCAG21/) and [Using ARIA](https://www.w3.org/TR/using-aria/) guidelines.

## Example

Here's an example anatomy of a `HvComp` component:

```ts
// HvComp.styles.ts
import { createClasses } from "@hitachivantara/uikit-react-utils";

export const { staticClasses, useClasses } = createClasses("HvComp", {
  /** Applied to the root element */
  root: {
    // leverage the ğŸ‘‡ `theme.` object
    padding: theme.spacing("xs"),
    backgroundColor: theme.colors.backgroundColor,
  },
  /** Applied to the root element when selected */
  selected: {},
  /** Applied to the root element when disabled */
  disabled: {
    // ğŸ‘‡ leverage global `disabled` instead of adding a `buttonDisabled`
    "& $button": {
      cursor: "not-allowed",
    },
  },
  /** Applied to the button element */
  button: {},
});
```

```tsx
// HvComp.tsx
import {
  useDefaultProps,
  type ExtractNames,
} from "@hitachivantara/uikit-react-utils";

import { HvBaseProps } from "../types/generic";
import { staticClasses, useClasses } from "./MyComp.styles";

// export `staticClasses` ğŸ‘‡ as `compClasses` (camelCase, no `Hv`)
export { staticClasses as compClasses };

// export the classes ğŸ‘‡ inferred from `useClasses`
export type HvCompClasses = ExtractNames<typeof useClasses>;

// extend the types to where `...others` ğŸ‘‡ is being passed
export interface HvCompProps extends HvBaseProps<HTMLDivElement> {
  // ğŸ‘‡ name boolean props so its obvious they're boolean
  selected?: boolean;
  // ğŸ‘‡ add JSDoc to the props, especially if they're complex
  /** Disables the component visually and its controls */
  disabled?: boolean;
  children?: ReactNode;
  // Use permissive ğŸ‘‡ `ReactNode` for props that are rendered as-is
  buttonContent?: ReactNode;
  // re-use types ğŸ‘‡ when possible
  onClick?: HvButtonProps["onClick"];
  // ğŸ‘‡ call handlers `on<Action>` or `on<Element><Action>` for sub-elements
  onButtonClick?: HvButtonProps["onClick"];
  // ğŸ‘‡ âŒ don't add redundant types (included in the parent interface)
  id?: string;
}

// ğŸ‘‡ Add a JSDoc block to the component explaining its purpose
/** HvComp does some amazing stuff */
export const HvComp = forwardRef<
  // no-indent
  React.ComponentRef<"div">,
  HvCompProps
>(function HvComp(props, ref) {
  const {
    children,
    // fix collisions ğŸ‘‡ by renaming to `<x>Prop`
    classes: classesProp,
    className,
    // ğŸ‘‡ make booleans be opt-in (default is false/undefined)
    selected,
    // ğŸ‘‡ don't  set defaults (ie `false`) unnecessarily
    disabled,
    buttonContent,
    onClick,
    onButtonClick,
    // ğŸ‘‡ call remaining props `others`
    ...others
    // use the ğŸ‘‡ useDefaultProps utility
  } = useDefaultProps("HvComp", props);
  // use the useClasses utility ğŸ‘‡
  const { classes, css, cx } = useClasses(classesProp);

  // internal state variables.
  const canSelect = !disabled && !selected;
  // reserve `useMemo` for expensive ğŸ‘‡ computations
  const hasElement = useMemo(() => expensiveSearch(children), [children]);

  // AVOID useEffect...
  useEffect(() => {
    // ğŸ‘‡ âŒ ...especially when dealing with event handlers
    onClick();
  }, [onClick]);

  // rename handlers ğŸ‘‡ (`handle<Action>`) and ğŸ‘‡ type them accordingly
  const handleButtonClick: HvButtonProps["onClick"] = (evt) => {
    evt.preventDefault();
    // use the ?. ğŸ‘‡ operator for optional event handlers & forward the event
    onButtonClick?.(evt);
  };

  // keep `render<Stuff>` as a `ReactNode` if possible
  // if you ğŸ‘‡ need `(props) => ReactNode`, it should likely be a separate component
  const renderContent = (
    <div>
      <span>{/* some content */}</span>
    </div>
  );

  return (
    <div
      // ğŸ‘‡ don't forget forwarding the ref
      ref={ref}
      // ğŸ‘‡ merge class names with `cx` provided by `useClasses`
      className={cx(
        // ğŸ‘‡ pass internal styles first, using `css`
        css(/* internal styles */),
        // ğŸ‘‡ ensure `classes.root` is on the root element
        classes.root,
        {
          // conditional classes ğŸ‘‡ are based on their *condition*
          [classes.selected]: selected,
          [classes.disabled]: disabled,
        },
        // ğŸ‘‡ pass user-defined `className` last
        className,
      )}
      onClick={disabled ? undefined : onClick}
      // ğŸ‘‡ forward others according to the types
      {...others}
    >
      <HvButton className={classes.button} onClick={handleButtonClick}>
        {buttonContent}
      </HvButton>
      {selected && renderContent}
      {children}
    </div>
  );
});
```
