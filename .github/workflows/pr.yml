name: Pull Request

on:
  pull_request:
    branches:
      - master

# Cancel previous call in progress
concurrency:
  group: ${{ github.head_ref }}
  cancel-in-progress: true

jobs:
  static-checks:
    name: Static Checks
    uses: ./.github/workflows/static-checks.yml

  applitools:
    name: Applitools
    uses: ./.github/workflows/tests-applitools.yml
    secrets: inherit
    with:
      batch-id: pr-${{ github.event.number }}

  chromatic:
    name: Chromatic
    if: contains(github.event.pull_request.labels.*.name, 'visual')
    uses: ./.github/workflows/tests-chromatic.yml
    secrets: inherit

  artifacts:
    name: Artifacts
    uses: ./.github/workflows/documentation.yml
    secrets: inherit
    with:
      publish-folder: pr-${{ github.event.number }}
      # publish-storybook: false # Uncomment when Chromatic is always used in PRs since it already builds the docs
